<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ahoi-nodejs-client</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">ahoi-nodejs-client</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> ahoi-nodejs-client</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<h1 id="ahoi-api-node-js-client">AHOI API Node.js Client</h1>
				<p><a href="https://github.com/sparkassen-hub/ahoi-nodejs-client"><img src="./AHOI-Logo.png" alt="Sparkassen Innovation
				Hub"></a></p>
				<h2 id="api-docs">API Docs</h2>
				<p><strong>&rarr; <a href="https://sparkassen-hub.github.io/ahoi-nodejs-client/classes/ahoiapifactory.html">API
				Docs</a></strong></p>
				<h2 id="ahoi-open-banking-api">AHOI - Open Banking API</h2>
				<p>The AHOI Open Banking API provides easy access to banks and payment service providers.
					The API can be used to retrieve account and deposit account information, execute transfers,
				determine forecasts, and more.</p>
				<p>Get more information about the AHOI API and API docs here:</p>
				<ul>
					<li><a href="https://banking-sandbox.starfinanz.de/ahoi/docs/cookbook/index.html">AHOI Cookbook</a></li>
					<li><a href="https://banking-sandbox.starfinanz.de/ahoi/docs/api/swagger-ui/index.html#!/resource/Access">AHOI Explorer</a></li>
					<li><a href="https://banking-sandbox.starfinanz.de/sandboxmanager/">AHOI Demo-Account</a></li>
					<li><a href="https://sparkassen-hub.github.io/ahoi-swagger-fetchclient/modules/_api_.html">AHOI Node.js API Docs</a></li>
				</ul>
				<h2 id="ahoi-node-js-client">AHOI Node.js Client</h2>
				<p>This Node.js module provides easy access to banks via the AHOI Open Banking API. The client module is designed to be used within an existing Node.js application. It extends it with the feature  to get accesses to bank data such as account transactions or deposit data.</p>
				<p>To simply try out the client or as a starting point for your own application, we recommend
				our demo application which uses this client:</p>
				<ul>
					<li><a href="https://github.com/sparkassen-hub/ahoi-nodejs-demo-app">AHOI Node.js Demo App</a></li>
				</ul>
				<h2 id="getting-started">Getting Started</h2>
				<h3 id="prerequisites">Prerequisites</h3>
				<ul>
					<li>Node.js in Version 10.0.0 oder höher. Die Installation ist hier beschrieben : <a href="https://nodejs.org/en/download/">Node.js download</a>.</li>
					<li>Eine Node.js-Anwendung, in die das Modul als Abhängigkeit eingebunden wird.</li>
				</ul>
				<h3 id="install-the-node-module">Install the node module</h3>
				<pre><code class="language-bash">npm install --save git+ssh://git@github.com:sparkassen-hub/ahoi-nodejs-client.git</code></pre>
				<h3 id="create-an-ahoi-demo-account">Create an AHOI demo account</h3>
				<p>Go to <a href="https://banking-sandbox.starfinanz.de/sandboxmanager/">AHOI Demo-Account</a> and register for a
				demo account.</p>
				<h3 id="get-bank-account-transactions-in-5-steps">Get bank account transactions in 5 steps</h3>
				<p>To get account transactions for an user you have to manage five steps:</p>
				<ol>
					<li>Create a new user in AHOI (technically: retrieve an installationId)</li>
					<li>Let the user select a bank</li>
					<li>Create bank access with PIN and username</li>
					<li>(Optional) Select one or more accounts (default is all)</li>
					<li>Show the transactions for the selected accounts</li>
				</ol>
				<h3 id="quickstart">Quickstart</h3>
				<p>The following code snippets show how to technical implement the steps from creating a user in AHOI
				to retrieving account transactions.</p>
				<p>A) Include the module in your code</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Typescript</span>
<span class="hljs-keyword">import</span> { AhoiApiFactory } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahoi-api-node'</span>;

<span class="hljs-comment">// JavaScript</span>
<span class="hljs-keyword">const</span> { AhoiApiFactory } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ahoi-api-node'</span>);</code></pre>
				<p>B) Add the configuration to access the AHOI API</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Configuration: see information below</span>
<span class="hljs-keyword">const</span> ahoiConfig = {
  clientId: <span class="hljs-string">'SBM_XXqaeX30T2D'</span>,
  clientSecret: <span class="hljs-string">'2e066yXXXLxa3zn'</span>,
  appSecretIv: <span class="hljs-string">'mP3IdoOKxVzOQzX22IueXg'</span>,
  appSecretKey: <span class="hljs-string">'dGw6XXtcyryKqXeeHgqPTg'</span>,
  cryptKey: <span class="hljs-string">'ScL&amp;aFPazDw6S#k3'</span>,
  baseurl: <span class="hljs-string">'https://banking-sandbox.starfinanz.de/ahoi/api/v2'</span>,
};

<span class="hljs-keyword">const</span> ahoiApi = <span class="hljs-keyword">new</span> AhoiApiFactory(ahoiConfig);</code></pre>
				<p>C) Create a new user in AHOI</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Get an installationid (and store it in your user management system)</span>
<span class="hljs-keyword">const</span> registrationApi: RegistrationApi = <span class="hljs-keyword">await</span> ahoiApi.getRegistrationApi();
<span class="hljs-keyword">const</span> installationId: RegistrationResponse = <span class="hljs-keyword">await</span> registrationApi.register();</code></pre>
				<p>D) Let the use select a bank, get a list of banks before</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Get a list of(banking) providers</span>
<span class="hljs-keyword">const</span> providerApi: ProviderApi = <span class="hljs-keyword">await</span> ahoiApi.getProviderApi(installationId);
<span class="hljs-keyword">const</span> providers: Provider[] = <span class="hljs-keyword">await</span> providerApi.getProviders();</code></pre>
				<p>E) Create bank access with PIN and username</p>
				<p>The bank access is linked with the installationId</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Grant banking access by a user</span>
<span class="hljs-keyword">const</span> accessApi: AccessApi = <span class="hljs-keyword">await</span> ahoiApi.getAccessApi(installationId);
<span class="hljs-comment">// To grant banking access the user must provide the pin and username or customernumber. It differs</span>
<span class="hljs-comment">// from bank to to bank which data additionally to the pin are needed.</span>
<span class="hljs-keyword">const</span> access: Access = {  
                          <span class="hljs-keyword">type</span>: <span class="hljs-string">'BankAccess'</span>,
                          providerId: provider[<span class="hljs-number">0</span>].id,
                          accessFields: {
                                          USERNAME: username,
                                          CUSTOMERNUMBER: customernumber,
                                          PIN: pin,
                                        },
                        };
<span class="hljs-keyword">const</span> allowedAccess: Access = <span class="hljs-keyword">await</span> accessApi.postAccess(access);</code></pre>
				<p>E) Select accounts.</p>
				<p>As AHOI initially fetches all accounts from a bank access, the accounts not
				selected by user must be deleted from AHOI.</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Delete banking accounts from AHOI or show as list</span>
<span class="hljs-keyword">const</span> accountApi: AccountApi = <span class="hljs-keyword">await</span> ahoiApi.getAccountApi(installationId);
<span class="hljs-comment">// accessid comes from banking access granted before: Access#id</span>
<span class="hljs-keyword">const</span> accounts: Account[] = <span class="hljs-keyword">await</span> accountApi.getAccounts(allowedAccess.id);
<span class="hljs-keyword">await</span> accountApi.deleteAccount(allowedAccess.id, accounts[<span class="hljs-number">0</span>].id);</code></pre>
				<p>F) Show account transactions</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// Show transactions for a bank account</span>
<span class="hljs-keyword">const</span> accessApi: AccessApi = <span class="hljs-keyword">await</span> ahoiApi.getAccessApi(Server.INSTALLATION_ID);
        <span class="hljs-keyword">const</span> transactions: Asset[] = accessApi.listAssets(accessId, accountId, <span class="hljs-number">30</span>);</code></pre>
				<h3 id="configuration">Configuration</h3>
				<p>The AHOI access data (<strong>clientId</strong>, <strong>clientSecret</strong>, <strong>appSecretIv</strong>, <strong>appSecretKey</strong>) can be found in your AHOI
				(demo) account.</p>
				<p><img src="./ahoi-access-data-sandbox.png" alt="AHOI credentials"></p>
				<p>The <strong>cryptKey</strong> is used to encrypt the installationId internally before it is stored e.g. in a user
					mangement system. This way it is ensured, that the installationId for an user is always stored
				encrypted.</p>
				<p>You can choose any password as cryptKey, but the recommended length is 32 chars.</p>
				<h3 id="test-it-with-your-demo-account">Test it with your demo account</h3>
				<p>To get transactions for a bank account, you have to grant access before. But for sure you don&#39;t want
				to use your real bank access data.</p>
				<p>Exactly for this AHOI has (technically) created a demo bank called Sandbank. After registration at
					AHOI you have automatically two demo accounts at this bank. You&#39;ll find your access
				data (PIN and username) in your AHOI account.</p>
				<p>When testing the client you should select as bank the &#39;Sandbank&#39;. To grant access to the bank use
				the PIN and username from your AHOI account (see below).</p>
				<p><img src="./ahoi-demo-bankaccount-data.png" alt="AHOI credentials"></p>
				<h3 id="installationid">InstallationId</h3>
				<p>An installationId is needed to fetch account data for an user. In AHOI it is not linked with a user
				but only with one or more accounts. Therefore the following procedure should be chosen:</p>
				<ol>
					<li>Fetch installationId from AHOI</li>
					<li>Save installationId for an user e.g. within your user management</li>
					<li>Add bank accesses to this installationId</li>
					<li>Retrieve transactions for an user using the installationId linked to the user</li>
				</ol>
				<h2 id="build-from-source">Build from source</h2>
				<pre><code class="language-bash"><span class="hljs-comment"># Build</span>
npm run build

<span class="hljs-comment"># Generate TS doc separate</span>
npm run doc</code></pre>
				<h2 id="license">License</h2>
				<p>Licensed under <a href="./LICENSE">MIT</a>.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-enum">
						<a href="enums/cipher.html" class="tsd-kind-icon">Cipher</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/aescrypt.html" class="tsd-kind-icon">AESCrypt</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/abstractahoiapifactory.html" class="tsd-kind-icon">Abstract<wbr>Ahoi<wbr>Api<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/abstractahoiauthenticationservice.html" class="tsd-kind-icon">Abstract<wbr>Ahoi<wbr>Authentication<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/abstracthttpfilter.html" class="tsd-kind-icon">Abstract<wbr>Http<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoiapifactory.html" class="tsd-kind-icon">Ahoi<wbr>Api<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoibankingtokenservice.html" class="tsd-kind-icon">Ahoi<wbr>Banking<wbr>Token<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoiclienttokenservice.html" class="tsd-kind-icon">Ahoi<wbr>Client<wbr>Token<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoihelper.html" class="tsd-kind-icon">Ahoi<wbr>Helper</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoipublickeyservice.html" class="tsd-kind-icon">Ahoi<wbr>Public<wbr>Key<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/ahoisessionkeyheaderservice.html" class="tsd-kind-icon">Ahoi<wbr>Session<wbr>Key<wbr>Header<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/authheaderfilter.html" class="tsd-kind-icon">Auth<wbr>Header<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/base64util.html" class="tsd-kind-icon">Base64<wbr>Util</a>
					</li>
					<li class=" tsd-kind-class tsd-has-type-parameter">
						<a href="classes/basiccache.html" class="tsd-kind-icon">Basic<wbr>Cache</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/cryptutil.html" class="tsd-kind-icon">Crypt<wbr>Util</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/encinstallationidcache.html" class="tsd-kind-icon">Enc<wbr>Installation<wbr>IdCache</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/encryptinstallationidfilter.html" class="tsd-kind-icon">Encrypt<wbr>Installation<wbr>IdFilter</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/encryptsessionfilter.html" class="tsd-kind-icon">Encrypt<wbr>Session<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/fetchhttpfactory.html" class="tsd-kind-icon">Fetch<wbr>Http<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/httprequesttimeoutfilter.html" class="tsd-kind-icon">Http<wbr>Request<wbr>Timeout<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/installationidcryptservice.html" class="tsd-kind-icon">Installation<wbr>IdCrypt<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/rsacrypt.html" class="tsd-kind-icon">RSACrypt</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/token.html" class="tsd-kind-icon">Token</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/tokencache.html" class="tsd-kind-icon">Token<wbr>Cache</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/ahoiconfig.html" class="tsd-kind-icon">Ahoi<wbr>Config</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/cachecleaner.html" class="tsd-kind-icon">Cache<wbr>Cleaner</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/httpcontext.html" class="tsd-kind-icon">Http<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/httpfilter.html" class="tsd-kind-icon">Http<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/simplecachecleaner.html" class="tsd-kind-icon">Simple<wbr>Cache<wbr>Cleaner</a>
					</li>
					<li class=" tsd-kind-interface tsd-is-not-exported">
						<a href="interfaces/tokendata.html" class="tsd-kind-icon">Token<wbr>Data</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>